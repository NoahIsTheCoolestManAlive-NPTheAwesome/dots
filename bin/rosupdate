#!/bin/bash

# ROS source installation: update check

build_dir=$HOME/.catkin_ws_build
dis="indigo"
version="desktop"
variant="$dis-$version"

echo "Checking for ${variant} updates..."
cd $build_dir
mv ${variant}-wet.rosinstall ${variant}-wet.rosinstall.old
rosinstall_generator $version --rosdistro $dis --deps --wet-only --tar > ${variant}-wet.rosinstall
difference=`diff -u ${variant}-wet.rosinstall ${variant}-wet.rosinstall.old`

if [ ${#difference} -eq 0 ]; then
    echo "No new updates found"
else
    echo "$difference"
    read -p "Do you wish to update your distro? " yn
    case $yn in
        [Yys]*)
            echo "Updating..."
            wstool merge -t src ${variant}-wet.rosinstall -r
            wstool update -t src
            echo -e " done.\nYou can now rebuild"
            ;;
        *)  ;;
    esac
fi

rm -f ${variant}-wet.rosinstall.old
